# core

Ce plugin propose une série d'instructions natives. Elles sont constamment disponibles car chargées automatiquement.

## installation

```bash
npm install @ezs/core
```

## usage

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [assign](#assign)
-   [concat](#concat)
-   [debug](#debug)
-   [delegate](#delegate)
-   [dispatch](#dispatch)
-   [dump](#dump)
-   [env](#env)
-   [exchange](#exchange)
-   [extract](#extract)
-   [group](#group)
-   [ignore](#ignore)
-   [keep](#keep)
-   [metrics](#metrics)
-   [pack](#pack)
-   [parallel](#parallel)
-   [remove](#remove)
-   [replace](#replace)
-   [shift](#shift)
-   [shuffle](#shuffle)
-   [spawn](#spawn)
-   [swing](#swing)
-   [time](#time)
-   [tracer](#tracer)
-   [transit](#transit)
-   [truncate](#truncate)
-   [ungroup](#ungroup)
-   [unpack](#unpack)
-   [validate](#validate)

### assign

Add a new field to an `Object`.

Input file:

```json
[{
   "a": 1,
},
{
   "a": 2,
},
{
   "a": 3,
},
{
   "a": 4,
},
{
   "a": 5,
}]
```

Script:

```ini
[assign]
path = b.c
value = 'X'
```

Output:

```json
[{
   "a": 1,
   "b": { "c": "X" },
},
{
   "a": 2,
   "b": { "c": "X" },
},
{
   "a": 3,
   "b": { "c": "X" },
},
{
   "a": 4,
   "b": { "c": "X" },
},
{
   "a": 5,
   "b": { "c": "X" },
}]
```

#### Parameters

-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of the new field
-   `value` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** value of the new field

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### concat

Take all `String`, concat them and throw just one.

```json
[
     "a",
     "b",
     "c"
]
```

Script:

```ini
[concat]
beginWith = <
joinWith = |
endWith = >
```

Output:

```json
[
     "<a|b|c>"
]
```

#### Parameters

-   `beginWith` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Add value at the begin
-   `joinWith` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** use value to join 2 chunk
-   `endWith` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Add value at the end

Returns **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### debug

Take `Object`, print it (with its number), and throw the same object.

#### Parameters

-   `level` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** console level : log or error (optional, default `log`)
-   `text` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** text before the dump (optional, default `valueOf`)
-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of field to print

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### delegate

Delegate processing to an external pipeline.

> **Note**: works like [spawn](#spawn), but each chunk share the same external pipeline.

#### Parameters

-   `file` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a file
-   `script` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a string of characters
-   `commands` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a object
-   `command` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a URL-like command

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### dispatch

Dispatch processing to an external pipeline on one or more servers.

#### Parameters

-   `file` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a file
-   `script` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a string of characters
-   `commands` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a object
-   `command` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a URL-like command

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### dump

Take all `Object`s and generate a JSON array

```json
[
    { "a": 1 },
    { "a": 2 },
    { "a": 3 },
    { "a": 4 },
    { "a": 5 }
]
```

Script:

```ini
[dump]
indent = true
```

Output:

```json
 [{
   "a": 1
  },
  {
   "a": 2
  },
  {
   "a": 3
  },
  {
   "a": 4
  },
  {
   "a": 5
  }
]
```

#### Parameters

-   `indent` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** indent JSON (optional, default `false`)

Returns **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### env

Send the input object again, while adding new environment field(s) with the
first `Object` of the feed.

#### Parameters

-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of the new field
-   `value` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** value of the new field

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### exchange

Take `Object` and throw a new item computed by the `value=` parameter (which
replace the input one).

Input file:

```json
[{
   "a": "abcdefg",
   "b": "1234567",
   "c": "XXXXXXX"
},
{
   "a": "abcdefg",
   "b": "1234567",
   "c": "XXXXXXX"
}]
```

Script:

```ini
[exchange]
value = omit('c')
```

Output:

```json
[{
   "a": "abcdefg",
   "b": "1234567"
},
{
   "a": "abcdefg",
   "b": "1234567"
}]
```

#### Parameters

-   `value` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** value to replace input object

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### extract

Take `Object` and throw each value of fields

> **Note**: extract cannot throw `undefined` or `null` values

```json
[{
   "a": "abcdefg",
   "b": "1234567",
   "c": "XXXXXXX"
},
{
   "a": "abcdefg",
   "b": "1234567",
   "c": "XXXXXXX"
}]
```

Script:

```ini
[extract]
path = a
path = b
```

Output:

```json
[
   "abcdefg",
   "1234567",
   "abcdefg",
   "1234567"
}]
```

#### Parameters

-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of field to extract

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### group

Take all `chunk`s, and throw them grouped by `length`.

See also [ungroup](#ungroup).

```json
[
     "a",
     "b",
     "c",
     "d",
     "e",
     "f",
     "g",
     "h"
]
```

Script:

```ini
[group]
length = 3
```

Output:

```json
[
     [ "a", "b", "c" ],
     [ "d", "e", "f" ],
     [ "g", "h" ]
]
```

#### Parameters

-   `length` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Size of each partition

Returns **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### ignore

Takes all the chunks, and ignore the firtst N chunk

Input file:

```json
[{
   "a": 1
},
{
   "a": 2
},
{
   "a": 3
},
{
   "a": 4
},
{
   "a": 5
}]
```

Script:

```ini
[ignore]
length = 3
```

Output:

```json
[{
   "a": 4
},
{
   "a": 5
}]
```

#### Parameters

-   `length` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Length of the feed to ignore

Returns **any** 

### keep

Throw input `Object` but keep only specific fields.

Input file:

```json
[{
   "a": "abcdefg",
   "b": "1234567",
   "c": "XXXXXXX"
},
{
   "a": "abcdefg",
   "b": "1234567",
   "c": "XXXXXXX"
}]
```

Script:

```ini
[keep]
path = a
path = b
```

Output:

```json
[{
   "a": "abcdefg",
   "b": "1234567"
},
{
   "a": "abcdefg",
   "b": "1234567"
}]
```

#### Parameters

-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of field to keep

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### metrics

Take `Object` and throw the same `Object`
But in print some Prometheus metrics

#### Parameters

-   `stage` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Stage name (optional, default `default`)
-   `bucket` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Bucket name (script name) (optional, default `unknow`)
-   `frequency` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** number of chunk between two metrics computation (optional, default `10`)

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### pack

Take all `Object`, throw encoded `String`

Returns **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### parallel

Takes an `Object` delegate processing to X internal pipelines

#### Parameters

-   `file` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a file
-   `script` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a string of characters
-   `commands` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a object
-   `command` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a URL-like command

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### remove

Take `Object` and remove it from the feed if test is true
Input file:

```json
[{
   a: "a"
},
{
   a: 2
},
{
   a: "b"
},
{
   a: 4
},
{
   a: "c"
}]
```

Script:

```ini
[remove]
test = get('a).isInteger()
```

Output:

```json
[
    {
       a: 2
    },
    {
       a: 4
    }
]
```

#### Parameters

-   `test` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** if test is true
-   `reverse` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** reverse the test (optional, default `false`)

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### replace

Take `Object` and replace it with a new object with some fields.

See also [exchange](#exchange) and [assign](#assign).

Input file:

```json
[{
   "a": 1
},
{
   "a": 2
},
{
   "a": 3
},
{
   "a": 4
},
{
   "a": 5
}]
```

Script:

```ini
[replace]
path = b.c
value = 'X'
```

Output:

```json
[{
   "b": { "c": "X" }
},
{
   "b": { "c": "X" }
},
{
   "b": { "c": "X" }
},
{
   "b": { "c": "X" }
},
{
   "b": { "c": "X" }
}]
```

#### Parameters

-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of the new field
-   `value` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** value of the new field

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### shift

Return the first `Object` and close the feed

Input file:

```json
[{
   "a": 1
},
{
   "a": 2
},
{
   "a": 3
},
{
   "a": 4
},
{
   "a": 5
}]
```

Script:

```ini
[shift]
```

Output:

```json
[{
   "a": 1
}]
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### shuffle

Take `Object`, shuffle data of the whole object or only some fields specified by path

Input file:

```json
[{
   "a": "abcdefg",
   "b": "1234567"
},
{
   "a": "abcdefg",
   "b": "1234567"
}]
```

Script:

```ini
[shuffle]
path = a
```

Output:

```json
[{
   "a": "cadbefg",
   "b": "1234567"
},
{
   "a": "dcaegbf",
   "b": "1234567"
}]
```

#### Parameters

-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of field to shuffle

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### spawn

Delegate processing to an external pipeline, throw each chunk from the result.

> **Note**: works like [delegate](#delegate), but each chunk use its own external pipeline

#### Parameters

-   `file` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a file
-   `script` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a string of characters
-   `commands` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in an object
-   `command` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in an URL-like command
-   `cache` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Use a specific ezs statement to run commands (advanced)

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### swing

Delegate processing to an external pipeline under specifics conditions

> **Note**: works like [spawn](#spawn), but each chunk shares the same external
> pipeline.

#### Parameters

-   `test` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** if test is true
-   `reverse` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** reverse the test (optional, default `false`)
-   `file` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a file
-   `script` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in a string of
    characters
-   `commands` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in an object
-   `command` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** the external pipeline is described in an URL-like
    command

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### time

Measure the execution time of a script, on each chunk of input.

#### Parameters

-   `script` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** 

#### Examples

Input


```javascript
[1]
```

Program


```javascript
const script = `
[transit]
`;
from([1])
    .pipe(ezs('time', { script }))
```

Output


```javascript
[{
  data: 1,
  time: 15 // milliseconds
}]
```

Returns **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### tracer

Take `Object`, print a character and throw the same object.
Useful to see the progress in the stream.

#### Parameters

-   `print` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** character to print at each object (optional, default `.`)
-   `last` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** character to print at last call (optional, default `.`)
-   `first` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** character to print at first call (optional, default `.`)

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### transit

Take `Object` and throw the same object again.

Input file:

```json
[{
   "a": 1
},
{
   "a": 2
}]
```

Script:

```ini
[transit]
```

Output:

```json
[{
   "a": 1
},
{
   "a": 2
}]
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### truncate

Takes all the chunks, and closes the feed when the total length is equal to the parameter.

Input file:

```json
[{
   "a": 1
},
{
   "a": 2
},
{
   "a": 3
},
{
   "a": 4
},
{
   "a": 5
}]
```

Script:

```ini
[truncate]
length = 3
```

Output:

```json
[{
   "a": 1
},
{
   "a": 2
},
{
   "a": 3
}]
```

#### Parameters

-   `length` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Length of the feed

Returns **any** 

### ungroup

Take all `chunk`s, and throw one item for every chunk.

See also [group](#group).

```json
[
     [ "a", "b", "c" ],
     [ "d", "e", "f" ],
     [ "g", "h" ]
]
```

Script:

```ini
[ungroup]
```

Output:

```json
[
     "a",
     "b",
     "c",
     "d",
     "e",
     "f",
     "g",
     "h"
]
```

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>** 

### unpack

Take `String`s or `Buffer`s and throw `Object` builded by JSON.parse on each line.

Returns **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### validate

From an `Object`, throw the same object if all rules pass

See

-   [Laravel validator rules](https://laravel.com/docs/8.x/validation)
-   <https://github.com/skaterdav85/validatorjs#readme>

Input file:

```json
[{
   "a": 1,
   "b": "titi"
},
{
   "a": 2,
   "b": "toto"
},
{
   "a": false
},
]
```

Script:

```ini
[validate]
path = a
rule = required|number

path = a
rule = required|string
```

Output:

```json
[{
   "a": 1,
   "b": "titi"
},
{
   "a": 2,
   "b": "toto"
}]
```

#### Parameters

-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of the field
-   `rule` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** rule to validate the field

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
