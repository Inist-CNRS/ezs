# Make pipeline of streams easy : Easy Streams

[![Build Status](https://travis-ci.org/touv/node-ezs.png?branch=master)](https://travis-ci.org/touv/node-ezs)

It's just a wrapper to build Stream transformers with functional style. It's like the koa / expressjs middlewares !

# Example

```javascript
const ezs = require('ezs')

ezs.use(require('ezs-basics'));

process.stdin.resume();
process.stdin.setEncoding('utf8');
process.stdin
  .pipe(ezs('split', { delimiter: "\n" }))
  .pipe(ezs('counter'))
  .pipe(ezs((input, output) => output.send(input.toString()));
  .pipe(process.stdout);
```

# Installation

With [npm](http://npmjs.org):

    $ npm install ezs

# Tests

Use [mocha](https://github.com/visionmedia/mocha) to run the tests.

    $ npm install mocha
    $ mocha test

# Concepts

### Scope

Each statement function have its own scope and can access to few methods :

-   this.isLast()
-   this.isFirst()
-   this.getIndex()
-   this.getParam(name, defaultValue)

### Output Object

Output object is an object with few methods :

-   output.write(something)
-   output.end()
-   output.send(something)
-   output.close()

# API Documentation

## ezs(statement : Mixed, [params : Object]) : Stream

Converts a transform stream with existing function or adhoc function.

```javascript
	const ezs = require('ezs'),
	let transformer = ezs(function(input, output) {
		output.send(input.toString())
	})
```

## ezs.use(module: Function) : None

Adding bundle of statements. see the avaible modules here : <https://www.npmjs.com/browse/keyword/ezs>

```javascript
	import ezs from 'ezs';
	import basics from 'ezs-basics';
	import files from 'ezs-files';

	ezs.use(basics);
	ezs.use(files);
```

## ezs.config = (name : String, options : Object)

To set globaly a statement parameter.

## ezs.pipeline = (commands, options : Object)

Launch a serie of statements.

## ezs.dispatch = (commands, options : Object)

Launch, through a server, a serie of statements.

## ezs.metaString = (commands: String, options : Object)

Parse an .ini string to extract global keys and values.

## ezs.metaFile = (filename : String, options : Object)

Parse an .ini file to extract global keys and values.

## ezs.parseString = (commands : String)

Parse an .ini string and return Object contains a serie of statements

## ezs.fromString = (commands, options : Object)

Parse an .ini string and launch a serie of statements

## ezs.parseFile = (filename : String)

Parse an .ini file and return Object contains a serie of statements

## ezs.fromFile(filename : String, options : Object)

Parse an .ini file and launch a serie of statements

## ezs.catch(func : Function)

catch Error in NodeJS pipeline

## ezs.toBuffer(options : Object)

get chunk of in NodeJS pipeline and send Buffer of the chunk

\##Â ezs.createCache = (options: Object)

To cache the result of the pipeline.
Options:

-   `max` **Number**  max items in the cache (optional, default `500`)
-   `maxAge` Number max age of items in the cache (optional, default `360000`)
-   `objectMode` Boolean cache for object (or Buffer) (optional, default `false`)

Example:

```javascript
    const cache = ezs.createCache({ objectMode: false });

    const cacheID = 'XXXXXX';
    const cached = cache1.get(cacheID);
    if (cached) {
        cached
            .pipe(process.stdout)
    } else {
        process.stdin
            .pipe(cache1.set(cacheID))
            .pipe(process.stdout)
    }
```

## ezs.createServer = (port : Number)

Launch a server for ezs.dispatch

## ezs.createCluster = (port : Number)

Launch a cluster for ezs.dispatch

# Statements

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [assign](#assign)
-   [concat](#concat)
-   [debug](#debug)
-   [extract](#extract)
-   [json](#json)
-   [jsonnd](#jsonnd)
-   [keep](#keep)
-   [ndjson](#ndjson)
-   [replace](#replace)
-   [shift](#shift)
-   [transit](#transit)

## assign

Take `Object` and add new field

**Parameters**

-   `data`  
-   `feed`  
-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of the new field
-   `value` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** value of the new field

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## concat

Take all `String`, concat them and thow just one

**Parameters**

-   `data`  
-   `feed`  
-   `beginWith` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Add value at the begin
-   `joinWith` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** use value to join 2 chunk
-   `endWith` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Add value at the end

Returns **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

## debug

Take `Object` , print it and throw the same object

**Parameters**

-   `data`  
-   `feed`  
-   `level` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** console level : log or error (optional, default `log`)
-   `text` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** text before the dump (optional, default `valueOf`)

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## extract

Take `Object` and throw each value of fields

**Parameters**

-   `data`  
-   `feed`  
-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of field to extract

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## json

Take all `String`, throw `Object` builded by JSON.parse

**Parameters**

-   `data`  
-   `feed`  

Returns **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

## jsonnd

Take all `Object`, throw encoded `String`

**Parameters**

-   `data`  
-   `feed`  

Returns **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

## keep

Take `Object` and throw the same object but keep only
spefici fields

**Parameters**

-   `data`  
-   `feed`  
-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of field to keep

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## ndjson

Take `String` and throw `Object` builded by JSON.parse on each line

**Parameters**

-   `data`  
-   `feed`  

Returns **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

## replace

Take `Object` and create a new object with some fields

**Parameters**

-   `data`  
-   `feed`  
-   `path` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** path of the new field
-   `value` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** value of the new field

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## shift

Take the first `Object` and close the feed

**Parameters**

-   `data`  
-   `feed`  

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## transit

Take `Object` and throw the same object

**Parameters**

-   `data`  
-   `feed`  

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

# Related projects

-   <https://github.com/rvagg/through2>
-   <https://github.com/dominictarr/event-stream>
-   <https://github.com/ZJONSSON/streamz>
-   <https://github.com/ZJONSSON/etl>
-   <https://github.com/chbrown/streaming>

# License

[MIT/X11](https://github.com/touv/node-ezs/blob/master/LICENSE)
